const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./form1-CvG3qnJv.js","./index-BxMqcClO.js","./index-Cbqofex6.css","./form2-6JlR_1f7.js","./form3-MaRAN_4b.js"])))=>i.map(i=>d[i]);
import{d as B,r as l,c as I,a as b,w as c,b as a,f as S,t as P,u as R,j as w,o as M,g as V,k as F,x as $,i as q,e as U,y as N,z,n as H,E as G}from"./index-BxMqcClO.js";import{d as K,g as j}from"./index-BP2T5S1M.js";import{_ as Q}from"./index.vue_vue_type_script_setup_true_lang-C3zXKwFx.js";const W=(k,m,p)=>{const r=k[m];return r?typeof r=="function"?r():Promise.resolve(r):new Promise((D,i)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(i.bind(null,new Error("Unknown variable dynamic import: "+m+(m.split("/").length!==p?". Note that variables only represent file names one level deep.":""))))})},X=B({__name:"record",setup(k,{expose:m}){const p=l([]),r={1:"同意",2:"拒绝",3:"返回发起人",4:"撤回",5:"同意",6:"同意"},D=f=>{var d;((d=p.value)==null?void 0:d.length)===0&&j("getFlowRecord",{flowId:f}).then(n=>{p.value=n.list})},i=f=>{switch(f){case 1:case 5:return"success";case 2:return"danger";case 3:return"warning";case 4:return"primary";case 6:return"info"}};return m({getData:D}),(f,d)=>{const n=b("el-table-column"),T=b("el-tag"),h=b("el-table");return w(),I(h,{data:p.value},{default:c(()=>[a(n,{label:"审批人",prop:"userName"}),a(n,{label:"节点名称",prop:"nodeName"}),a(n,{label:"处理时间",prop:"dateTime"},{default:c(({row:g})=>[S(P(R(K)(g.dateTime)),1)]),_:1}),a(n,{label:"状态",prop:"status"},{default:c(({row:g})=>[a(T,{type:i(g.status)},{default:c(()=>[S(P(r[g.status]),1)]),_:2},1032,["type"])]),_:1}),a(n,{label:"审批意见",prop:"remark"})]),_:1},8,["data"])}}}),Y={key:1},oe=B({__name:"flowDetail",props:{detail:{type:Boolean,default:!0}},emits:["submit"],setup(k,{expose:m,emit:p}){const r=k,D=p,i=l(),f=l(),d=l(),n=l();l(!1);const T=l(),h=l({}),g=e=>{T.value=e,j("getFlowById",{id:e}).then(async t=>{h.value=t.nodeStatus,await C(t.flowId,t.approver),f.value.setValue(JSON.parse(t.formContent))})},C=(e,t)=>new Promise((s,_)=>{j("getDesignFlowById",{id:e}).then(async o=>{d.value=o.formType;const v=JSON.parse(o.content);if(t){const E=JSON.parse(t);v.nodes.forEach(u=>{const y=E[u.id];y&&u.properties.userType==="4"&&(u.properties.joinName=y.name,u.properties.joinUserId=y.id)})}i.value.render(v),await A(o),s()})}),A=e=>new Promise(async(t,s)=>{if(e.formType===1){const _=await W(Object.assign({"../../components/flowForm/form1.vue":()=>N(()=>import("./form1-CvG3qnJv.js").then(o=>o._),__vite__mapDeps([0,1,2]),import.meta.url),"../../components/flowForm/form2.vue":()=>N(()=>import("./form2-6JlR_1f7.js").then(o=>o._),__vite__mapDeps([3,1,2]),import.meta.url),"../../components/flowForm/form3.vue":()=>N(()=>import("./form3-MaRAN_4b.js").then(o=>o._),__vite__mapDeps([4,1,2]),import.meta.url)}),`../../components/flowForm/${e.formId}.vue`,5);n.value=z(_.default),t()}}),x=e=>{var o;const t=i.value.getDesignFlowData(),s=[],_={};(o=t.nodes)==null||o.forEach(v=>{if(["userTask","sysTask"].includes(v.type)){const{userType:E,joinUserId:u,nodeName:y,joinName:L}=v.properties||{};E==="4"&&!u&&s.push(`审批节点：${y}需要选择审批人`),E==="4"&&u&&(_[v.id]={id:u,name:L})}}),s.length>0?G({message:s[0],type:"error"}):D("submit",JSON.stringify(e),JSON.stringify(_))},O=l(),J=e=>{H(()=>{e==="flow"&&r.detail?i.value.setStatus(h.value):e==="recoder"&&O.value.getData(T.value)})};return m({getFlowData:g,getFlowDesignDetail:C}),M(()=>{let e="";r.detail&&(e="detail"),window.sessionStorage.setItem("pageType",e)}),(e,t)=>{const s=b("el-tab-pane"),_=b("el-tabs");return w(),V("div",null,[a(_,{onTabChange:J,"model-value":"form"},{default:c(()=>[a(s,{label:"表单",name:"form"},{default:c(()=>[d.value===1?(w(),I(q(n.value),{key:0,ref_key:"flowFormEl",ref:f,disabled:e.detail,onSubmit:x},null,40,["disabled"])):F("",!0),d.value===0?(w(),V("div",Y,t[0]||(t[0]=[S("可自行集成ak-design的拖拽表单"),U("br",null,null,-1),S(" https://337547038.github.io/vue-form-design/#/design/form ")]))):F("",!0),$(e.$slots,"default")]),_:3}),a(s,{label:"流程图",name:"flow"},{default:c(()=>[a(R(Q),{isSilentMode:!0,ref_key:"flowDesignEl",ref:i,sourceApply:!e.detail},null,8,["sourceApply"])]),_:1}),e.detail?(w(),I(s,{key:0,label:"审批记录",name:"recoder"},{default:c(()=>[a(X,{ref_key:"recoderListEl",ref:O},null,512)]),_:1})):F("",!0)]),_:3})])}}});export{oe as _};
