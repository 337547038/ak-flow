import{_ as E}from"./flowDetail.vue_vue_type_script_setup_true_lang-QnIEcgYT.js";import{g as w,d as I,f as T,a as B}from"./index-DsCWcemI.js";import{d as U,r as d,o as M,g as S,b as t,w as l,a as r,F as j,f as n,t as i,u as C,e as q,n as z,E as A,j as J}from"./index-50_AZSGT.js";import"./index.vue_vue_type_script_setup_true_lang-BQcQE86j.js";const P=U({__name:"todo",setup(O){const v=d(),y=d([]),f=d({}),V=a=>`${f.value[a.userId]}发起的${a.name}`,c=a=>{var e;if(a){const s=JSON.parse(a);for(const u in s)if((e=s[u].userId)!=null&&e.split(",").includes(B().id+""))return s[u].nodeName}return""},m=d(!1),b=d(),F=a=>{m.value=!0,z(()=>{b.value=a.id,v.value.getFlowData(a.id)})},g=()=>{w("getTodoFlow",{}).then(a=>{y.value=a.list,f.value=a.userDict})},p=d(),_=a=>{w("submitApproval",{status:a,id:b.value,remark:p.value}).then(e=>{A({message:"审批成功",type:"success"}),m.value=!1,g()})};return M(()=>{g()}),(a,e)=>{const s=r("el-table-column"),u=r("el-button"),N=r("el-table"),$=r("el-input"),k=r("el-form-item"),x=r("el-form"),D=r("el-drawer");return J(),S(j,null,[t(N,{data:y.value,style:{width:"100%"}},{default:l(()=>[t(s,{type:"selection",width:"55"}),t(s,{prop:"title",label:"标题",width:"200"},{default:l(({row:o})=>[n(i(V(o)),1)]),_:1}),t(s,{prop:"name",label:"发起人"},{default:l(({row:o})=>[n(i(f.value[o.userId]),1)]),_:1}),t(s,{prop:"date",label:"发起时间",width:"180"},{default:l(({row:o})=>[n(i(C(I)(o.startTime)),1)]),_:1}),t(s,{label:"节点名称"},{default:l(({row:o})=>[n(i(c(o.currentNode)),1)]),_:1}),t(s,{prop:"classify",label:"流程类型"},{default:l(({row:o})=>[n(i(C(T)[o.classify]),1)]),_:1}),t(s,{label:"操作"},{default:l(({row:o})=>[t(u,{link:"",type:"primary",onClick:R=>F(o)},{default:l(()=>e[5]||(e[5]=[n("审批")])),_:2},1032,["onClick"]),t(u,{link:"",type:"primary"},{default:l(()=>e[6]||(e[6]=[n("委托")])),_:1})]),_:1})]),_:1},8,["data"]),t(D,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=o=>m.value=o),direction:"rtl",size:"80%",title:"流程详情","destroy-on-close":""},{default:l(()=>[t(E,{ref_key:"flowFormEl",ref:v},{default:l(()=>[e[12]||(e[12]=q("h3",null,"审批意见",-1)),t(x,null,{default:l(()=>[t(k,{label:"审批意见"},{default:l(()=>[t($,{placeholder:"请输入审批意见",modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=o=>p.value=o)},null,8,["modelValue"])]),_:1}),t(k,null,{default:l(()=>[t(u,{type:"primary",onClick:e[1]||(e[1]=o=>_(1))},{default:l(()=>e[7]||(e[7]=[n("同意")])),_:1}),t(u,{type:"danger",onClick:e[2]||(e[2]=o=>_(2))},{default:l(()=>e[8]||(e[8]=[n("拒绝")])),_:1}),t(u,{type:"warning",onClick:e[3]||(e[3]=o=>_(3))},{default:l(()=>e[9]||(e[9]=[n("退回发起人")])),_:1}),t(u,{type:"info"},{default:l(()=>e[10]||(e[10]=[n("委托")])),_:1}),t(u,null,{default:l(()=>e[11]||(e[11]=[n("指定审批人")])),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue"])],64)}}});export{P as default};
